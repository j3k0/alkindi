# Alkindi

Statistics module for haxe. Generates AS3 and JS.

## Summary

This API solves generic issues with handling game statitics.

 * Number of victories and defeats
 * Longuest / current winning spree (number of succecutive victories)
 * User leveling

## API

### Import the package

#### Javascript
```js
var alkindi = require("alkindi");
```

#### Actionscript
```actionscript
import alkindi.Alkindi;
```

### Types

#### Games

```
Date :: Number (timestamp)

GameId :: String

Username :: String

Level :: Number

Score :: Number

PlayerScore {
    username : Username
    score : Score
}

Game {
    id : GameId
    date : Date
    players : Array(PlayerScore)
}
```

#### Player Level

Level reflects experience in the game. Each defeat of victory will change level points. Level points will decay over time while not playing. A global ranking can just be the list of players ordered by level points (but this is not managed by this library).

```
LevelUpdate {
    newLevel : Level
}

GameOutcome {
    game : Game
    outcome : LevelUpdate
}

PlayerArchive {
    username : String
    games : Array(GameOutcome)
}

PlayerGameOutcome {
    username : String
    game : GameOutcome
}

PlayerScoreAndLevel {
    username: String
    score : Score
    level: Level
}

-- Define how Level updates while playing
LevelUpdateFunction : Array(PlayerScoreAndLevel) -> Username -> LevelUpdate

-- Define how Level decays while not playing
-- Player's level will decay from start date to end date,
-- from given Level to the returned LevelUpdate.
LevelDecayFunction : Date -> Date -> Level -> LevelUpdate
```

#### Player Stats

```
DateValue {
    date : Date
    value : Number
}

PlayerStats {
    username : Username
    victories : Array(DateValue)
    defeats : Array(DateValue)
    rankings : Array(DateValue)
    winningSprees : Array(DateValue)
}
```

### Exported Functions

#### addGame

```
addGame :: LevelUpdateFunction -> LevelDecayFunction -> Array(PlayerArchive) -> Game -> Array(PlayerGameOutcome)
```

Note: if the added game is already in the player archive: outcome will be an empty array.

#### simpleLevelUpdate

```
simpleLevelUpdate :: LevelUpdateFunction
```

This level function will increase `level` by:

 * `30` points for the player(s) with the best score
 * `7` for other players

#### simpleLevelDecay

```
simpleLevelDecay :: LevelDecayFunction
```

Level decreases 1 point per day, but won't go below 0.

#### getPlayerStats

```
getPlayerStats :: PlayerArchive -> PlayerStats
```

## Build

Build system uses no tools or dependencies that aren't in a docker image, except for make. Only have docker installed and type one of the commands below, it shouldn't bother with any missing dependencies.

If you find it more conveniant, you can use locally installed haxe by setting `export dhaxe=/path/to/haxe`

### Javascript

Javascript output can be generated by typing:

`make js`

This gonna generate a file called `build/alkindi.js`

To use the library from javascript:

```sh
npm install alkindi
```

```js
alkindi = require(alkindi);

function newLevel(players, me) {
    return ...;
}

var outcomes = alkindi.addGame(newLevel, [], {
    date: +new Date(),
    players: [{
        username: "jeko",
        score: 85
    }, {
        username: "sousou",
        score: 94
    }]
});
```

### Actionscript

Actionscript output can be generated by typing:

`make swc`

This gonna generate a file called `build/alkindi.swc`

### Test

To run unit tests:

`make test`

